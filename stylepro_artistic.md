## æ¯•åŠ ç´¢
å·´å‹ƒç½—Â·æ¯•åŠ ç´¢ï¼ˆPablo Picassoï¼Œ1881å¹´10æœˆ25æ—¥ï½1973å¹´4æœˆ8æ—¥ï¼‰ï¼Œè¥¿ç­ç‰™ç”»å®¶ã€é›•å¡‘å®¶ï¼Œæ³•å›½å…±äº§å…šå…šå‘˜ã€‚æ˜¯ç°ä»£è‰ºæœ¯çš„åˆ›å§‹äººï¼Œè¥¿æ–¹ç°ä»£æ´¾ç»˜ç”»çš„ä¸»è¦ä»£è¡¨ã€‚æ¯•åŠ ç´¢æ˜¯å½“ä»£è¥¿æ–¹æœ€æœ‰åˆ›é€ æ€§å’Œå½±å“æœ€æ·±è¿œçš„è‰ºæœ¯å®¶ï¼Œæ˜¯20ä¸–çºªæœ€ä¼Ÿå¤§çš„è‰ºæœ¯å¤©æ‰ä¹‹ä¸€ã€‚ã€
## é£æ ¼ä»‹ç»
æ¯•åŠ ç´¢çš„è‰ºæœ¯ç”Ÿæ¶¯å‡ ä¹è´¯ç©¿å…¶ä¸€ç”Ÿï¼Œä½œå“é£æ ¼ä¸°å¯Œå¤šæ ·ï¼Œåäººç”¨â€œæ¯•åŠ ç´¢æ°¸è¿œæ˜¯å¹´è½»çš„â€çš„è¯´æ³•å½¢å®¹æ¯•åŠ ç´¢å¤šå˜çš„è‰ºæœ¯å½¢å¼ã€‚å²å­¦ä¸Šä¸å¾—ä¸æŠŠä»–æµ©ç¹çš„ä½œå“åˆ†ä¸ºä¸åŒçš„æ—¶æœŸâ€”â€”æ—©å¹´çš„â€œè“è‰²æ—¶æœŸâ€ã€â€œç²‰çº¢è‰²æ—¶æœŸâ€ã€ç››å¹´çš„â€œé»‘äººæ—¶æœŸâ€ã€â€œåˆ†æå’Œç»¼åˆç«‹ä½“ä¸»ä¹‰æ—¶æœŸâ€ï¼ˆåˆç§°â€œç«‹ä½“ä¸»ä¹‰æ—¶æœŸâ€ï¼‰ã€åæ¥çš„â€œè¶…ç°å®ä¸»ä¹‰æ—¶æœŸâ€ç­‰ç­‰ã€‚ ä»–äº1907å¹´åˆ›ä½œçš„ã€Šäºšå¨å†œå°‘å¥³ã€‹æ˜¯ç¬¬ä¸€å¼ è¢«è®¤ä¸ºæœ‰ç«‹ä½“ä¸»ä¹‰å€¾å‘çš„ä½œå“ï¼Œæ˜¯ä¸€å¹…å…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰çš„è‘—åæ°ä½œã€‚å®ƒä¸ä»…æ ‡å¿—ç€æ¯•åŠ ç´¢ä¸ªäººè‰ºæœ¯å†ç¨‹ä¸­çš„é‡å¤§è½¬æŠ˜ï¼Œè€Œä¸”ä¹Ÿæ˜¯è¥¿æ–¹ç°ä»£è‰ºæœ¯å²ä¸Šçš„ä¸€æ¬¡é©å‘½æ€§çªç ´ï¼Œå¼•å‘äº†ç«‹ä½“ä¸»ä¹‰è¿åŠ¨çš„è¯ç”Ÿã€‚
##### ä»¥ä¸Šéƒ½ä¸æ˜¯æˆ‘çŸ¥é“çš„ï¼Œéƒ½ç°ä¹°ç°å–æŠ„è‡ªç™¾åº¦ç™¾ç§‘é‡Œçš„O(âˆ©_âˆ©)O

# æˆå“å±•ç¤º
## æ¯•åŠ ç´¢ç”»é£çš„è’™å¨œä¸½è


```python
%matplotlib inline
from PIL import Image
import matplotlib.pyplot as plt
plt.figure(figsize=[20,6])
plt.subplot(1,3,1)
plt.imshow(Image.open('work/MonaLisa.jpg'))
plt.axis('off')
plt.xticks([])
plt.subplot(1,3,2)
plt.imshow(Image.open('work/style.jpg'))
plt.axis('off')
plt.xticks([])
plt.subplot(1,3,3)
plt.imshow(Image.open('transfer_result/ndarray_1590844241.6393652.jpg'))
plt.axis('off')
plt.xticks([])
plt.show()
```


![png](output_2_0.png)


## æ¯•åŠ ç´¢ç”»é£çš„BadAppleMV


```python
from IPython.display import HTML
HTML('<iframe style="width:98%;height: 450px;" src=//player.bilibili.com/player.html?aid=710442177&bvid=BV1QQ4y1P745&cid=184801392&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>"   webkitallowfullscreen="true" mozallowfullscreen="true" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>')
```

    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/IPython/core/display.py:694: UserWarning: Consider using IPython.display.IFrame instead
      warnings.warn("Consider using IPython.display.IFrame instead")





<iframe style="width:98%;height: 450px;" src=//player.bilibili.com/player.html?aid=710442177&bvid=BV1QQ4y1P745&cid=184801392&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>"   webkitallowfullscreen="true" mozallowfullscreen="true" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>



### è·å–ç›¸å…³å›¾ç‰‡


```python
!wget -O work/style.jpg https://bkimg.cdn.bcebos.com/pic/203fb80e7bec54e7ddbcbb56b8389b504fc26a22?x-bce-process=image/watermark,g_7,image_d2F0ZXIvYmFpa2U4MA==,xp_5,yp_5
!wget -O work/MonaLisa.jpg https://bkimg.cdn.bcebos.com/pic/4610b912c8fcc3ceb33fb3d19945d688d53f2050?x-bce-process=image/resize,m_lfit,w_500,h_500,limit_1
```

    --2020-05-30 21:06:54--  https://bkimg.cdn.bcebos.com/pic/4610b912c8fcc3ceb33fb3d19945d688d53f2050?x-bce-process=image/resize,m_lfit,w_500,h_500,limit_1
    Resolving bkimg.cdn.bcebos.com (bkimg.cdn.bcebos.com)... 182.61.128.198
    Connecting to bkimg.cdn.bcebos.com (bkimg.cdn.bcebos.com)|182.61.128.198|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 22009 (21K) [image/jpeg]
    Saving to: â€˜work/MonaLisa.jpgâ€™
    
    work/MonaLisa.jpg   100%[===================>]  21.49K  --.-KB/s    in 0s      
    
    2020-05-30 21:06:54 (83.7 MB/s) - â€˜work/MonaLisa.jpgâ€™ saved [22009/22009]
    


## stylepro_artisticæ¥å£ä»‹ç»
è¿™é‡Œä½¿ç”¨stylepro_artisticæ¨¡å‹å…¶æ¨¡å‹æ¥å£è¯´æ˜å¦‚ä¸‹ï¼š
```python
def style_transfer(self,
                   images=None,
                   paths=None,
                   alpha=1,
                   use_gpu=False,
                   visualization=False,
                   output_dir='transfer_result'):
```
1. images (list[dict]): ndarray æ ¼å¼çš„å›¾ç‰‡æ•°æ®ã€‚æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¸ºä¸€ä¸ª dictï¼Œæœ‰å…³é”®å­— content, styles, weights(å¯é€‰)ï¼Œç›¸åº”å–å€¼ä¸ºï¼š
1. content (numpy.ndarray): å¾…è½¬æ¢çš„å›¾ç‰‡ï¼Œshape ä¸º [H, W, C]ï¼ŒBGRæ ¼å¼ï¼›
1. styles (list[numpy.ndarray]) : ä½œä¸ºåº•è‰²çš„é£æ ¼å›¾ç‰‡ç»„æˆçš„åˆ—è¡¨ï¼Œå„ä¸ªå›¾ç‰‡æ•°ç»„çš„shape éƒ½æ˜¯ [H, W, C]ï¼ŒBGRæ ¼å¼ï¼›
1. weights (list[float], optioal) : å„ä¸ª style å¯¹åº”çš„æƒé‡ã€‚å½“ä¸è®¾ç½® weights æ—¶ï¼Œé»˜è®¤å„ä¸ª style æœ‰ç€ç›¸åŒçš„æƒé‡ï¼›
1. paths (list[str]): å›¾ç‰‡çš„è·¯å¾„ã€‚æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¸ºä¸€ä¸ª dictï¼Œæœ‰å…³é”®å­— content, styles, weights(å¯é€‰)ï¼Œç›¸åº”å–å€¼ä¸ºï¼š
1. content (str): å¾…è½¬æ¢çš„å›¾ç‰‡çš„è·¯å¾„ï¼›
1. styles (list[str]) : ä½œä¸ºåº•è‰²çš„é£æ ¼å›¾ç‰‡çš„è·¯å¾„ï¼›
1. weights (list[float], optioal) : å„ä¸ª style å¯¹åº”çš„æƒé‡ã€‚å½“ä¸è®¾ç½® weights æ—¶ï¼Œå„ä¸ª style çš„æƒé‡ç›¸åŒï¼›
1. alpha (float) : è½¬æ¢çš„å¼ºåº¦ï¼Œ[0, 1] ä¹‹é—´ï¼Œé»˜è®¤å€¼ä¸º1ï¼›
1. use_gpu (bool): æ˜¯å¦ä½¿ç”¨ GPUï¼›
1. visualization (bool): æ˜¯å¦å°†ç»“æœä¿å­˜ä¸ºå›¾ç‰‡ï¼Œé»˜è®¤ä¸º False;
1. output_dir (str): å›¾ç‰‡çš„ä¿å­˜è·¯å¾„ï¼Œé»˜è®¤è®¾ä¸º transfer_result ã€‚


```python
# å®‰è£…stylepro_artistic
!pip install --upgrade paddlehub -i https://pypi.tuna.tsinghua.edu.cn/simple
!hub install stylepro_artistic
```

    Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple
    Collecting paddlehub
    [?25l  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/c4/42/f5f7739e1f411999c601c8a8f9afd52b5393f1860722ca02244f2e1dc4a6/paddlehub-1.7.0-py3-none-any.whl (290kB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 296kB 8.2MB/s eta 0:00:01
    [?25hRequirement already satisfied, skipping upgrade: flake8 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (3.7.9)
    Requirement already satisfied, skipping upgrade: six>=1.10.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (1.12.0)
    Requirement already satisfied, skipping upgrade: colorlog in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (4.1.0)
    Requirement already satisfied, skipping upgrade: sentencepiece in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (0.1.85)
    Collecting visualdl==2.0.0b1 (from paddlehub)
    [?25l  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/ad/29/cadee04980b10757df62f7eb19e92b6ec95e00c0bcba89a3d1454c492cba/visualdl-2.0.0b1-py3-none-any.whl (1.6MB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.6MB 44kB/s eta 0:00:0101
    [?25hRequirement already satisfied, skipping upgrade: yapf==0.26.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (0.26.0)
    Requirement already satisfied, skipping upgrade: cma>=2.7.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (2.7.0)
    Requirement already satisfied, skipping upgrade: gunicorn>=19.10.0; sys_platform != "win32" in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (20.0.4)
    Requirement already satisfied, skipping upgrade: protobuf>=3.6.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (3.10.0)
    Requirement already satisfied, skipping upgrade: flask>=1.1.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (1.1.1)
    Requirement already satisfied, skipping upgrade: pre-commit in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (1.21.0)
    Requirement already satisfied, skipping upgrade: pandas; python_version >= "3" in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from paddlehub) (0.23.4)
    Requirement already satisfied, skipping upgrade: pyflakes<2.2.0,>=2.1.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flake8->paddlehub) (2.1.1)
    Requirement already satisfied, skipping upgrade: mccabe<0.7.0,>=0.6.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flake8->paddlehub) (0.6.1)
    Requirement already satisfied, skipping upgrade: entrypoints<0.4.0,>=0.3.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flake8->paddlehub) (0.3)
    Requirement already satisfied, skipping upgrade: pycodestyle<2.6.0,>=2.5.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flake8->paddlehub) (2.5.0)
    Collecting Flask-Babel>=1.0.0 (from visualdl==2.0.0b1->paddlehub)
      Downloading https://pypi.tuna.tsinghua.edu.cn/packages/76/a4/0115c7c520125853037fc1d6b3da132a526949640e27a699a13e05ec7593/Flask_Babel-1.0.0-py3-none-any.whl
    Requirement already satisfied, skipping upgrade: opencv-python in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from visualdl==2.0.0b1->paddlehub) (4.1.1.26)
    Requirement already satisfied, skipping upgrade: numpy in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from visualdl==2.0.0b1->paddlehub) (1.16.4)
    Requirement already satisfied, skipping upgrade: requests in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from visualdl==2.0.0b1->paddlehub) (2.22.0)
    Collecting Pillow>=7.0.0 (from visualdl==2.0.0b1->paddlehub)
    [?25l  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/ab/f8/d3627cc230270a6a4eedee32974fbc8cb26c5fdb8710dd5ea70133640022/Pillow-7.1.2-cp37-cp37m-manylinux1_x86_64.whl (2.1MB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2.1MB 54.2MB/s eta 0:00:01
    [?25hRequirement already satisfied, skipping upgrade: setuptools>=3.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from gunicorn>=19.10.0; sys_platform != "win32"->paddlehub) (41.4.0)
    Requirement already satisfied, skipping upgrade: click>=5.1 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flask>=1.1.0->paddlehub) (7.0)
    Requirement already satisfied, skipping upgrade: Werkzeug>=0.15 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flask>=1.1.0->paddlehub) (0.16.0)
    Requirement already satisfied, skipping upgrade: itsdangerous>=0.24 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flask>=1.1.0->paddlehub) (1.1.0)
    Requirement already satisfied, skipping upgrade: Jinja2>=2.10.1 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from flask>=1.1.0->paddlehub) (2.10.3)
    Requirement already satisfied, skipping upgrade: cfgv>=2.0.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (2.0.1)
    Requirement already satisfied, skipping upgrade: pyyaml in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (5.1.2)
    Requirement already satisfied, skipping upgrade: nodeenv>=0.11.1 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (1.3.4)
    Requirement already satisfied, skipping upgrade: toml in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (0.10.0)
    Requirement already satisfied, skipping upgrade: importlib-metadata; python_version < "3.8" in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (0.23)
    Requirement already satisfied, skipping upgrade: virtualenv>=15.2 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (16.7.9)
    Requirement already satisfied, skipping upgrade: identify>=1.0.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (1.4.10)
    Requirement already satisfied, skipping upgrade: aspy.yaml in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pre-commit->paddlehub) (1.3.0)
    Requirement already satisfied, skipping upgrade: python-dateutil>=2.5.0 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pandas; python_version >= "3"->paddlehub) (2.8.0)
    Requirement already satisfied, skipping upgrade: pytz>=2011k in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from pandas; python_version >= "3"->paddlehub) (2019.3)
    Collecting Babel>=2.3 (from Flask-Babel>=1.0.0->visualdl==2.0.0b1->paddlehub)
    [?25l  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/15/a1/522dccd23e5d2e47aed4b6a16795b8213e3272c7506e625f2425ad025a19/Babel-2.8.0-py2.py3-none-any.whl (8.6MB)
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 8.6MB 20kB/s eta 0:00:0111
    [?25hRequirement already satisfied, skipping upgrade: chardet<3.1.0,>=3.0.2 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->visualdl==2.0.0b1->paddlehub) (3.0.4)
    Requirement already satisfied, skipping upgrade: idna<2.9,>=2.5 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->visualdl==2.0.0b1->paddlehub) (2.8)
    Requirement already satisfied, skipping upgrade: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->visualdl==2.0.0b1->paddlehub) (1.25.6)
    Requirement already satisfied, skipping upgrade: certifi>=2017.4.17 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from requests->visualdl==2.0.0b1->paddlehub) (2019.9.11)
    Requirement already satisfied, skipping upgrade: MarkupSafe>=0.23 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from Jinja2>=2.10.1->flask>=1.1.0->paddlehub) (1.1.1)
    Requirement already satisfied, skipping upgrade: zipp>=0.5 in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from importlib-metadata; python_version < "3.8"->pre-commit->paddlehub) (0.6.0)
    Requirement already satisfied, skipping upgrade: more-itertools in /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages (from zipp>=0.5->importlib-metadata; python_version < "3.8"->pre-commit->paddlehub) (7.2.0)
    [31mERROR: visualdl 2.0.0b1 has requirement six>=1.14.0, but you'll have six 1.12.0 which is incompatible.[0m
    Installing collected packages: Babel, Flask-Babel, Pillow, visualdl, paddlehub
      Found existing installation: Pillow 6.2.0
        Uninstalling Pillow-6.2.0:
          Successfully uninstalled Pillow-6.2.0
      Found existing installation: visualdl 1.3.0
        Uninstalling visualdl-1.3.0:
          Successfully uninstalled visualdl-1.3.0
      Found existing installation: paddlehub 1.6.0
        Uninstalling paddlehub-1.6.0:
          Successfully uninstalled paddlehub-1.6.0
    Successfully installed Babel-2.8.0 Flask-Babel-1.0.0 Pillow-7.1.2 paddlehub-1.7.0 visualdl-2.0.0b1
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/sklearn/externals/joblib/externals/cloudpickle/cloudpickle.py:47: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
      import imp
    2020-05-30 21:08:08,928-INFO: font search path ['/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/ttf', '/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/afm', '/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/pdfcorefonts']
    2020-05-30 21:08:09,347-INFO: generated new fontManager
    Downloading stylepro_artistic
    [==================================================] 100.00%
    Uncompress /home/aistudio/.paddlehub/tmp/tmpbla21_e7/stylepro_artistic
    [==================================================] 100.00%
    Successfully installed stylepro_artistic-1.0.0


## å•ä¸ªå›¾åƒçš„èåˆ
### å½“è’™å¨œä¸½èé‡ä¸Šæ¯•åŠ ç´¢çš„ç”»é£æ—¶


```python
%matplotlib inline
import matplotlib.pyplot as plt
import paddlehub as hub
import cv2

stylepro_artistic = hub.Module(name="stylepro_artistic")
result = stylepro_artistic.style_transfer(
    images=[{
        'content': cv2.imread('work/MonaLisa.jpg'),
        'styles': [cv2.imread('work/style.jpg')]
    }],
    alpha=1,
    visualization=True)
    
plt.imshow(result[0]['data'])

```

    [32m[2020-08-01 20:13:15,228] [    INFO] - Installing stylepro_artistic module[0m
    [32m[2020-08-01 20:13:15,229] [    INFO] - Module stylepro_artistic already installed in /home/aistudio/.paddlehub/modules/stylepro_artistic[0m



```python
import paddlehub as hub


stylepro_artistic = hub.Module(name="stylepro_artistic")
result = stylepro_artistic.style_transfer(
    paths=[{
        'content':'work/MonaLisa.jpg',
        'styles': ['work/style3.jpg']
    }],
    visualization=False)
# print(result)

```

    [32m[2020-08-06 14:41:47,597] [    INFO] - Installing stylepro_artistic module[0m


    Downloading stylepro_artistic
    [==================================================] 100.00%
    Uncompress /home/aistudio/.paddlehub/tmp/tmpre7qutmr/stylepro_artistic
    [==================================================] 100.00%


    [32m[2020-08-06 14:41:54,204] [    INFO] - Successfully installed stylepro_artistic-1.0.0[0m



```python
%matplotlib inline
import matplotlib.pyplot as plt
plt.imshow(result[0]['data'])
```

    2020-08-06 14:42:07,500-INFO: font search path ['/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/ttf', '/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/afm', '/opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/matplotlib/mpl-data/fonts/pdfcorefonts']
    2020-08-06 14:42:08,042-INFO: generated new fontManager





    <matplotlib.image.AxesImage at 0x7f271a6e0c50>




![png](output_12_2.png)


### æ˜¾ç¤ºåŸå›¾ï¼Œstyleçš„å›¾ç‰‡ä»¥åŠï¼Œåˆæˆåçš„å›¾ç‰‡


```python
%matplotlib inline
from PIL import Image
import matplotlib.pyplot as plt
plt.figure(figsize=[20,6])
plt.subplot(1,3,1)
plt.imshow(Image.open('work/MonaLisa.jpg'))
plt.axis('off')
plt.xticks([])
plt.subplot(1,3,2)
plt.imshow(Image.open('work/style.jpg'))
plt.axis('off')
plt.xticks([])
plt.subplot(1,3,3)
plt.imshow(Image.open('transfer_result/ndarray_1590844241.6393652.jpg'))
plt.axis('off')
plt.xticks([])
plt.show()
```


![png](output_14_0.png)


## æ›´å¤§èƒ†çš„æƒ³æ³•
å½“BadApple MVä¸ä¸Šæ¯•åŠ ç´¢ç”»é£æ—¶ï¼Œ
##### BadAppleæ˜¯ç½‘å‹ç‰¹å–œæ¬¢ç©çš„ä¸€ä¸ªåŠ¨ç”»ï¼Œç»å¸¸æœ‰æŠ€æœ¯å®…å¤§ä½¬æŠŠè¿™äº›MVæ”¾åˆ°å„ç§èƒ½äº®çš„è®¾å¤‡ä¸Šæ’­æ”¾


```python
# è¿™é‡Œå°†è§†é¢‘çš„æ¯ä¸€å¸§éƒ½æå–å‡ºæ¥äº†
# ç„¶åæ ¹æ®æ¯ä¸€å¸§è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œä¿ç•™æºç ï¼Œä½†åé¢ä»£ç ä¸æ­¤æ— å…³ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œåé¢çš„
import cv2
from tqdm import tqdm
video = cv2.VideoCapture("work/badapple.mp4")
fps = video.get(cv2.CAP_PROP_FPS)
frameCount = video.get(cv2.CAP_PROP_FRAME_COUNT)
size = (int(video.get(cv2.CAP_PROP_FRAME_WIDTH)), int(video.get(cv2.CAP_PROP_FRAME_HEIGHT)))
print("æ€»å…±çš„å¸§æ•°ä¸ºï¼š",frameCount)
success, frame = video.read() 
index = 0
for i in tqdm(range(int(frameCount)),desc='å¤„ç†è¿›åº¦'):
    if success:
        cv2.imwrite('work/target/'+str(index)+'.jpg', frame)
    success, frame = video.read()
    index += 1
    if index == 400:
        break
```

    å¤„ç†è¿›åº¦:   1%|â–         | 71/5379 [00:00<00:14, 364.11it/s]

    æ€»å…±çš„å¸§æ•°ä¸ºï¼š 5379.0


    å¤„ç†è¿›åº¦:   2%|â–         | 105/5379 [00:00<00:14, 353.90it/s]å¤„ç†è¿›åº¦:   7%|â–‹         | 381/5379 [00:01<00:15, 325.12it/s]


### å°†è§†é¢‘çš„æ¯ä¸€å¸§ä¸å›¾ç‰‡è¿›è¡Œèåˆï¼Œæœ€åä¿å­˜ä¸ºå›¾ç‰‡
##### è¿™æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹CPUè·‘äº†16ä¸ªå°æ—¶


```python
%env CUDA_VISIBLE_DEVICES=0 # æŒ‡å®šGPUè®¾å¤‡
import cv2
import paddlehub as hub
from tqdm import tqdm
stylepro_artistic = hub.Module(name="stylepro_artistic")
video = cv2.VideoCapture("work/badapple.mp4")
fps = video.get(cv2.CAP_PROP_FPS)
frameCount = video.get(cv2.CAP_PROP_FRAME_COUNT)
size = (int(video.get(cv2.CAP_PROP_FRAME_WIDTH)), int(video.get(cv2.CAP_PROP_FRAME_HEIGHT)))
print("æ€»å…±çš„å¸§æ•°ä¸ºï¼š",frameCount)
success, frame = video.read() 
file_paths = []
index = 0
for i in tqdm(range(int(frameCount))):
    if success and index > 33:
            result = stylepro_artistic.style_transfer(
                images=[{
                    'content': frame,
                    'styles': [cv2.imread('work/style.jpg')]
                }],
                visualization=True,
                use_gpu=True,
                output_dir='transvideo_result')
            file_paths.append(result[0]['save_path'])
    elif success:
        filep = 'transvideo_result/'+str(index)+'.jpg'
        cv2.imwrite(filep, frame)
        file_paths.append(filep)
    success, frame = video.read()
    index += 1
videoWriter = cv2.VideoWriter('transbadaplle.avi', cv2.VideoWriter_fourcc(*"MJPG"), fps, size)
flag = True
for i in tqdm(file_paths):
    videoWriter.write(cv2.imread(i))
videoWriter.release()
```

    [32m[2020-06-01 15:24:52,634] [    INFO] - Installing stylepro_artistic module[0m
    [32m[2020-06-01 15:24:52,636] [    INFO] - Module stylepro_artistic already installed in /home/aistudio/.paddlehub/modules/stylepro_artistic[0m


    env: CUDA_VISIBLE_DEVICES=0


      0%|          | 0/5379 [00:00<?, ?it/s]

    æ€»å…±çš„å¸§æ•°ä¸ºï¼š 5379.0


    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5379/5379 [39:44<00:00,  2.26it/s]


### å°†å›¾ç‰‡åˆæˆä¸ºè§†é¢‘


```python
import os
import cv2
import datetime
from tqdm import tqdm
file_dict = {}
video = cv2.VideoCapture("work/badapple.mp4")
fps = video.get(cv2.CAP_PROP_FPS)
frameCount = video.get(cv2.CAP_PROP_FRAME_COUNT)
size = (int(video.get(cv2.CAP_PROP_FRAME_WIDTH)), int(video.get(cv2.CAP_PROP_FRAME_HEIGHT)))
for i in os.listdir('transvideo_result/'):
    file_dict['transvideo_result/'+i] = float(i.replace('ndarray_','').replace('.jpg',''))
file_dict = sorted(file_dict.items(),key = lambda x:x[1])
videoWriter = cv2.VideoWriter('transbadaplle.avi', cv2.VideoWriter_fourcc(*"MJPG"), fps, size)
flag = True
for i in tqdm(file_dict):
    if flag:
        for j in range(34):
            videoWriter.write(cv2.imread('work/target/0.jpg'))
        flag = False
    videoWriter.write(cv2.imread(i[0]))
videoWriter.release()
# cv2.destroyAllWindows()
```

    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5345/5345 [00:31<00:00, 170.87it/s]


## æˆå“å±•ç¤º


```python
from IPython.display import HTML
HTML('<iframe style="width:98%;height: 450px;" src=//player.bilibili.com/player.html?aid=710442177&bvid=BV1QQ4y1P745&cid=184801392&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>"   webkitallowfullscreen="true" mozallowfullscreen="true" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>')
```

    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/IPython/core/display.py:694: UserWarning: Consider using IPython.display.IFrame instead
      warnings.warn("Consider using IPython.display.IFrame instead")





<iframe style="width:98%;height: 450px;" src=//player.bilibili.com/player.html?aid=710442177&bvid=BV1QQ4y1P745&cid=184801392&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>"   webkitallowfullscreen="true" mozallowfullscreen="true" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>



### ç½‘ç»œä¸€é”®éƒ¨ç½²


```python
# hub serving start -m stylepro_artistic
```


```python
import requests
import json
import cv2
import base64
import paddlehub as hub
import numpy as np
%matplotlib inline
import matplotlib.pyplot as plt

def cv2_to_base64(image):
    data = cv2.imencode('.jpg', image)[1]
    return base64.b64encode(data.tostring()).decode('utf8')

def base64_to_cv2(b64str):
    data = base64.b64decode(b64str.encode('utf8'))
    data = np.fromstring(data, np.uint8)
    data = cv2.imdecode(data, cv2.IMREAD_COLOR)
    return data

data = {'images':[
    {
        'content':cv2_to_base64(cv2.imread('work/MonaLisa.jpg')),
        'styles':[cv2_to_base64(cv2.imread('work/style.jpg'))]
    }
]}

headers = {"Content-type": "application/json"}
url = "http://127.0.0.1:8866/predict/stylepro_artistic"
r = requests.post(url=url, headers=headers, data=json.dumps(data))

plt.imshow(base64_to_cv2(r.json()["results"][0]['data']))
# print(base64_to_cv2(r.json()["results"][0]['data']))
```


    ---------------------------------------------------------------------------

    IndexError                                Traceback (most recent call last)

    <ipython-input-6-a9a4f7a35f36> in <module>
         30 r = requests.post(url=url, headers=headers, data=json.dumps(data))
         31 
    ---> 32 plt.imshow(base64_to_cv2(r.json()["results"][0]['data']))
         33 # print(base64_to_cv2(r.json()["results"][0]['data']))


    IndexError: string index out of range



```python
r.json()
```




    {'msg': 'Please check data format!', 'results': '', 'status': '-1'}



è¯·ç‚¹å‡»[æ­¤å¤„](https://ai.baidu.com/docs#/AIStudio_Project_Notebook/a38e5576)æŸ¥çœ‹æœ¬ç¯å¢ƒåŸºæœ¬ç”¨æ³•.  <br>
Please click [here ](https://ai.baidu.com/docs#/AIStudio_Project_Notebook/a38e5576) for more detailed instructions. 
